{% extends 'base.html' %}
{% load static %}
{% block title %} {% endblock %}

{% block script %}
    <script src="{% static 'bootstrap/vendor/jquery/jquery.min.js' %}"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#projectSelect').change(function () {
                var projectID = $(this).val();
                // Clear the code dropdown
                $('#coderepoSelect').empty().append('<option value="">Select a repository</option>');
                if (projectID) {
                    $.ajax({
                        url: "{% url 'repository:get_coderepo' %}",
                        data: {
                            'project_id': projectID
                        },
                        success: function (data) {
                            $('#coderepoSelect').prop('disabled', false);
                            $.each(data.coderepo, function (index, code) {
                                $('#coderepoSelect').append('<option value="' + code.code_project_id + '">' + code.code_repo_name + '</option>');
                            });
                        }
                    });
                } else {
                    $('#coderepoSelect').prop('disabled', true);
                }
            });
        });
</script>
{% endblock %}
{% block maincontent %}

    <div class="row justify-content-center">

            <div class="col-xl-5 col-lg-6 col-md-9">

                <div class="card o-hidden border-0 shadow-lg my-5">
                    <div class="card-body p-0">
                        <!-- Nested Row within Card Body -->
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="p-5">
                                    <div class="text-center">
                                        <h1 class="h4 text-gray-900 mb-4">Commit To Code Repository</h1>
                                        <hr>
                                    </div>
                                    <form class="user" action="{% url 'repository:process_code_selection' %}" method="post" >
                                        {% csrf_token %}
                                        <div class="form-group">
                                            <select class="form-select form-control" id="projectSelect" name="project" required>
                                                <option value="">Select a project</option>
                                                {% for project in projects %}
                                                    <option value="{{ project.project_id }}">{{ project.project_name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <select class="form-select form-control" id="coderepoSelect" name="coderepo" disabled required>
                                                <option value="">Select a repository</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn btn-primary btn-block">Commit</button>
                                        <hr>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>

{% endblock %}


